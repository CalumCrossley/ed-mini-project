\section{Foundational material}

\todo{Orlov reconstruction, action on cohomology, HKR isomorphism, mutations}

\subsection{The derived category of an abelian category}
\subsubsection{Localization}

Need a class of localizing objects, basically need things to be able to write inverses on the right and left. It turns out quasiisomorphisms are a localizing class not on the nose, but only up to homotopy.

In other words, we can always replace $f:X\rightarrow Y, s:Z\rightarrow Y$ by another morphism $s':T\rightarrow X$ i.e.  $s'f=gs,fs^{-1}=(s')^{-1}g$

$$\begin{CD} T @>g>> Z \\ @Vs'VV @VVsV \\ X @> >f > Y\end{CD}$$

\begin{definition}{Localization}{Localization}
    Suppose $\mathcal{C}$ has a localizing class $S$. Then $\mathcal{C}[S^{-1}]$ is the category with objects the same as that of $\mathcal{C}$ and morphisms given by equivalence classes of roofs which we think of as $s^{-1}f$. Two roofs are the same if there is a bigger roof restricting to them (think of this as a larger numerator, or lcm)
\end{definition}

Composition is defined by choosing some roof as follows: !insert diagram!
 
Under these constructions, morphisms in $S$ become invertible. 

\begin{theorem}{}{Quis form a localizing class}
    Quasiisomosphism form a localizing class in the homotopy category of an abelian category $K(\mathcal{A})$. We denote the derived category by$$D(\mathcal{A}):=K(\mathcal{A})[Q^{-1}]$$
\end{theorem}

This is an additive category. Moreover, the cohomology functor factors through this.

\begin{definition}{Mapping cone}{Mapping cone}
    The mapping cone of $f:A^\bullet\xrightarrow{}B^\bullet$ is the complex $A^\bullet[1]\oplus B^\bullet$ and differential $\begin{pmatrix} -d_A & 0 \\ f & d_B
\end{pmatrix}$.\end{definition}

The three objects fit into a long exact sequence coming from a distinguished triangle. We see that $f$ is a quasiisomorphism iff $cone(f)=0$. 

\begin{proposition}{}{cones}
    $\mathrm{cone}(B\xrightarrow{\tau} \mathrm{cone}(f))\simeq A$ in the homotopy category.
\end{proposition}

This shows that the cone of a cone is the original object. So cones just go around distinguished triangles. One needs to show that the two morphisms described below are homotopy inverses. One is easy: it composes to identity. The other one is also not too bad.

%$$\begin{CD}A_{i+1}@> \begin{pmatrix}
%-f \\ 1 \\ 0
%\end{pmatrix}> > B_{{i+1}}\oplus A_{{i+1}}\oplus B_{i} @> > > A_{{i+1}} \\ @V -d_{A} VV @VV\begin{pmatrix}
%-d_{B}& 0 & 0 \\ 0 & -d_{A} & 0 \\1 & f & d_{B}
%\end{pmatrix}V @VV-d_{A}V \\ A_{i+2} @> > > B_{i+2}\oplus A_{i+2}\oplus B_{i+1}@> > > A_{i+2}\end{CD}$$

Next, we see that the following diagram commutes:$$\begin{CD} B @> > > \mathrm{cone}(f)@> > > A[-1] \\ @V=VV @V=VV @VVV\\B @> > > \mathrm{cone}(f) @> > > \mathrm{cone(\tau)}\end{CD}$$
%I.e. the following triangles are the same: 
%![[Cone of a cone|center|700]]

Now we can complete the proof that quasiisomorphisms form a localizing class in the homotopy category:
\begin{proof}
    The benefit of this is that we can replace $A\rightarrow B\rightarrow \mathrm{cone(f)}$ with $B\rightarrow \mathrm{cone}(f)\rightarrow \mathrm{cone(\tau)}$ and compose $\tau$ with another morphism. Recall that we wanted to show quasiisomorphisms form a localizing class, so we'd like to be able to factorize in two ways: suppose $f$ is a quasiisomorphism and $g$ is any morphism. We'd like to find $?$ such that $?\rightarrow C$ is a quasiisomorphism and the diagram commutes.
    $$\begin{CD} ? @> > > C \\ @VVV @VVgV \\ A @> > f> B\end{CD}$$
    This comes down to the following diagram: 
    $$\begin{CD} \mathrm{cone}(\tau g)[-1]@> quis> > C @> > > \mathrm{cone}(f) @> > > \mathrm{cone}(\tau g)\\ @VVV @VgVV @V=VV @VVV \\ \mathrm{cone(\tau)[-1]}@> > > B @> \tau> > \mathrm{cone}(f)@> > > \mathrm{cone}(\tau) \\ @VquisVV @V=VV @V=VV @VVV \\ A @> > f > B @> > > \mathrm{cone}(f)@> > > A[1]\end{CD}$$
    Since $f$ is a quasiisomorphism, we see that $\mathrm{cone}(f)=0$ and hence $\mathrm{cone}(\tau g)$ must be quasiisomorphic to $C[1]$. So we put $?=\mathrm{cone}(\tau g)[-1]$.
\end{proof} 

\subsubsection{Hom sets in the derived category}

Now we want to show that $$\mathrm{Ext}_{\mathcal{A}}^i(A,B)=\mathrm{Hom_{D \mathcal{A}}}(A, B[i])$$
To compute Ext, we need to replace $A$ by a projective resolution $P^\bullet \rightarrow A$, then Hom into $B$ and take cohomology. Equivalently, can resolve $B$ by injectives $B\rightarrow I^\bullet$, Hom from $A$ and take cohomology.

To do this, first need the following: 

\begin{proposition}{}{}
     If $A\rightarrow B$ is a quasiisomorphism and $I$ is a bounded below complex of injectives, then $$\mathrm{Hom}_{K\mathcal{A}}(B,I)\simeq \mathrm{Hom}_{K\mathcal{A}}(A,I)$$
\end{proposition}

To prove this, use general properties about injective objects. Look at e.g. Weibel.

This then implies that if $A$ is arbitrary and $I$ is a complex of injectives, then $$\mathrm{Hom}_{K\mathcal{A}}(A,I)\simeq \mathrm{Hom}_{D\mathcal{A}}(A,I)$$by looking at the description of a morphism in the derived category.

Now take an injective resolution $B\rightarrow I^\bullet$. We see that $$\mathrm{Hom}_{D\mathcal{A}}(A,B[i])\simeq \mathrm{Hom}_{K\mathcal{A}}(A,I^\bullet[i])$$But this is given by a morphism $f:A\rightarrow I^i$ which should be a chain map: 
$$\begin{CD}0 @> > > A @> > > 0 \\ @VVV @VfVV @VVV \\ I^{i-1} @> > > I^i @> > > I^{i+1} \end{CD}$$
Hence, we can think of $f$ as a map in $\mathrm{Hom}(A, I^\bullet)_{i}$ which is closed. Moreover, it is exact precisely when it factors through $I^{i-1}$ which is the same as saying it is nullhomotopic. This completes the comparison between $\mathrm{Ext}^i(A,B)$ and $\mathrm{Hom}_{D\mathcal{A}}(A,B[i])$. 

\subsubsection{Derived functors}
When we have either enough projectives or injectives, then we can restrict to the full subcategory of such objects. 

\begin{theorem}{}{}
    Assume $\mathcal{A}$ has enough projectives. Then $$K^{-}(\mathcal{P})\simeq D^{-}(\mathcal{A})$$Dually, if there are enough injectives, $$K^{+}(\mathcal{I})\simeq D^{+}(\mathcal{A})$$
\end{theorem}

This allows for the definition of a derived functor, as follows:

Suppose $F$ is an additive functor between abelian categories $\mathcal{A}, \mathcal{B}$. Then it induces a functor on the homotopy categories, by applying it termwise. If it is exact, then it sends quasiisomorphissms to quasiisomorphisms and commutes with kernels, cokernels etc.

Suppose now that $F$ is left exact, e.g. pushforward functor. Then we can define $RF$, the right derived functor of $F$, by choosing an inverse to the equivalence on the left:  $$\begin{CD} D^+(\mathcal{A)} @> > > D^+(\mathcal{B)} \\ @A A A  @A A A \\ K^+(\mathcal{I}_{A})@> F> >K^+(\mathcal{B}) \end{CD}$$
Explicitly, we choose an injective resolution and define $$RF(A^\bullet):=F(I^\bullet)$$

\paragraph{Derived functors in geometry}
Now let's do some geometry. Have functors: 

\begin{itemize}
    \item $\Gamma:\mathbf{Qcoh}(X)\xrightarrow{}Ab$
    \item $\mathrm{Hom}: \mathbf{Qcoh}(X)\times \mathbf{Qcoh}(X)\xrightarrow{ }Ab$
    \item given $f:X\xrightarrow{ }Y$, have $f_*:\mathbf{Qcoh}(X)\xrightarrow{}\mathbf{Qcoh}(Y)$. For $Y=\mathrm{Spec}(\mathbb{Z})$, pushforward is the same as taking global sections of the sheaf.
    \item $\lHom:\mathbf{Qcoh}(X)\times \mathbf{Qcoh}(X)\xrightarrow{} \mathbf{Qcoh}(X)$. Notice $\Gamma(\lHom)=\mathrm{Hom}$. These are left exact.
    \item $\otimes$, $f^*$. These are right exact. Note that $f^{-1}$ is exact, but to get $f^*$ one tensors with the structure sheaf. 
\end{itemize}

Note that $\mathbf{Qcoh}(X)$ has enough injectives, but not a lot of projectives. So can define right derived functors.

We would like to say that, since $g_{*}\circ f_{*}=(g\circ f)_{*}$ that the same holds for their derived versions.

Issue: the pushforward does not respect injectives! We will introduce another class of sheaves, the flasque ones, to make this work. Now, pushforwards respect flasque sheaves! This is an example of what is called an adapted class:

\begin{definition}{Acyclic objects and adapted classes}{Adapted classes}
     An object is called $F$-acyclic if $R^iF(A)=0, \forall i>0$. A class of objects is adapted to $F$ if it is closed under $\oplus$, all objects in the class are $F$-acyclic and every object in $\mathcal{A}$ can be embedded in an object of the class.
        
\end{definition}

\begin{theorem}{Composition of derived functors}{Composition of derived functors}
    Suppose $F:\mathcal{A}\xrightarrow{}\mathcal{B}, G:\mathcal{B}\xrightarrow{}\mathcal{C}$ are two functors such that $F(R_{\mathcal{A}})\subset R_{\mathcal{B}}$, where these are adapted classes for $F$ and $G$ respectively. Then $RG\circ RF = R(G\circ F)$.
\end{theorem}

Notice that one can throw in all $F$-acyclic objects in the adapted class, but that would cause a problem if we want the inclusion to hold.

Since pushforwards send flasques to flasques, and flasques are an adapted class, we get what we originally wanted.

\paragraph{Derived functors of Hom}

Take $E$ a quasicoherent sheaf. Then local Homs form a left exact functor $\lHom(E,-)$ and we can form its right derived functor $$\RlHom:D^+(\mathbf{Qcoh}(X))\xrightarrow{}D^+(\mathbf{Qcoh}(X))$$

Crucially, projective varieties have enough vector bundles to resolve any sheaf:

\begin{proposition}{}{}
    If $X$ is projective, then $\mathbf{Coh}(X)$ has enough locally frees.  
\end{proposition}

The reason is that given $F$, there is $n>>0$ such that $F(n)$ is generated by global sections. These are given by maps $\mathcal{O}_{X}\xrightarrow{}F(n)$ and since we have many of them, then we get a surjection $\mathcal{O}_{X}^N\xrightarrow{}F(n)$. Can then untwist. In this case, every bounded above complex of coherent sheaves is quasiisomorphic to a bounded above complex of vector bundles. If $X$ is regular, can just take bounded. Need Hilbert syzygy theorem.

Now, $\lHom(E,-)$ takes injectives to flasques. From this, we see that $$\RHom(E,-)=\RG(\RlHom(E,-))$$

What about $\mathbf{R}\lHom(E^\bullet, F^\bullet)$? Note that $\lHom(E^\bullet,-)$ is not a functor between $\mathrm{Qcoh}$, but between homotopy categories. Need lemma:

\begin{lemma}{}{}
    If $E^\bullet$ or $F^\bullet$ is acyclic and $F^\bullet$ is a complex of injectives, then $\lHom(E^\bullet, F^\bullet)$ is acyclic.
\end{lemma}

Recall that the hom between complexes is defined as the complex $$\lHom(E^\bullet, F^\bullet)_{k}=\prod \lHom(E_{i}, F_{i+k})$$

Recall the hom complex $$\mathrm{Hom}^n(A,B)=\prod \mathrm{Hom} (A^i, B^{i+n})$$with differential $df=d_{B}f-(-1)^nfd_{A}$. We see that $Z^0$ is just chain maps, whereas $B^0$ is chain homotopies, so $H^0$ is $\mathrm{Hom}_{\mathcal{K}}(A,B)$, i.e. morphisms up to homotopy. 

This construction is consistent with shifting by $n$. So $$H^n(\mathrm{Hom}^\bullet(A,B))=H^0(\mathrm{Hom}^\bullet(A,B[n])=\mathrm{Hom}_{\mathcal{K}}(A,B[n])$$
If we want to compute $\mathrm{RHom}(A,B)$, we replace $B$ by a complex of injectives $I$ and then this should just be $\mathrm{Hom}^\bullet(A,I)$. 

As a corollary, we see that $$H^n\mathrm{RHom}(A,B)\simeq \mathrm{Hom}_{\mathcal{D}}(A,B[n])$$just as we had for objects before, but now for arbitrary complexes of e.g. sheaves.

\paragraph{Compatibilities between derived functors}

Locally frees should be an adapted class for $f^*$. Recall what this means: 
\begin{itemize}
    \item should be closed under $\oplus$
    \item everything should be a quotient of a vector bundle
    \item vector bundles should be $f^*$-acyclic
\end{itemize}

But we don't have enough projectives, so the last condition does not make sense. We need an equivalent one: if $E^\bullet$ is acyclic complex of locally frees, we require that $f^*E^\bullet$ is still acyclic.

Recall: to derive $\lHom(\mathcal{F}, -)$ we can resolve second term by injectives, whereas to derive $\lHom(-,\mathcal{G})$ we can resolve first term by vector bundles. Similarly for complexes of sheaves.For the derived tensor product $\mathcal{F}^\bullet\otimes^L \mathcal{G}^\bullet$, have the same story, except need only use locally frees on either side. Have nice properties which can be checked on locally frees, and then taking complexes of locally frees e.g. associativity: $(E^\bullet \otimes F^\bullet ) \otimes G^\bullet \simeq E^\bullet \otimes (F^\bullet \otimes G)$

Since we have an adapted class of locally frees, get left derived $\dL f^*:D^-(\mathbf{Coh}\,Y)\rightarrow D^-(\mathbf{Qcoh X})$. Since pullbacks of vector bundles are vector bundles, we see that $$\dL g^*\circ \dL f^*=\dL (g\circ f)^*$$

%*Exercise:* blow up origin at plane, derive pull back structure sheaf at origin.

We have other compatibilities: 
$$\begin{gathered} \dL f^*(\mathcal{E}^\bullet \otimes^L \mathcal{F}^\bullet)\simeq \dL f^*\mathcal{E}^\bullet \otimes^L \dL f^* \mathcal{F}^\bullet \\ 
\RHom(\mathcal{E}^\bullet, \RlHom(\mathcal{F}^\bullet,\mathcal{G}^\bullet))\simeq \RlHom(\mathcal{E}^\bullet\otimes^L \mathcal{ F}, \mathcal{G}^\bullet)\\
\RlHom(\mathcal{E}^\bullet, \mathcal{F}^\bullet)\otimes^L \mathcal{G}^\bullet
\simeq \RlHom(\mathcal{E}^\bullet, \mathcal{F}\otimes^L \mathcal{G}^\bullet)\\
\mathcal{E}^\lor\otimes \mathcal{G}^\bullet \simeq \RlHom(\mathcal{E}^\bullet, \mathcal{G}^\bullet), \mathcal{E^\lor = \RlHom(\mathcal{E}, \mathcal{O}}_{X})\end{gathered} $$

Also have an adjunction projection formula as usual: 
$$\begin{gathered}
    \dR f_{*}\RlHom_{X}(Lf^*\mathcal{E},\mathcal{F})\simeq \RlHom_{Y}(\mathcal{E}, \dR f_{*}\mathcal{F}) \\
\RlHom_{X}(\dL f^*\mathcal{E}, \mathcal{F})\simeq \RHom_{Y}(\mathcal{E}, \dR f_{*}\mathcal{F})
\end{gathered}$$
Works if $\mathcal{E}$ is injective, $\mathcal{F}$ locally free. The second version comes from the first one by taking global sections. Note that $\Gamma f_{*} \mathcal{G}=\Gamma \mathcal{G}$ and the same holds upon applying derived functors.

The adjunction formula is a version of the projection formula.
$$\dR f_{*} (\mathcal{E}\otimes^L \dL f^*\mathcal{F})\simeq (\dR f_{* }\mathcal{E})\otimes^L \mathcal{F}$$
The projection formula, as well as the other ones, usually requires that $\mathcal{F}$ be locally free, but in the derived setting it works for everything, since we resolve by locally frees! 

\begin{theorem}{Cohomology and base change}{Cohomology and base change}
    Suppose we have a flat morphism $g:Y\xrightarrow{}Z$ and a pullback square $$\begin{CD}W @> \tilde{f}> > Y \\ @V\tilde{g}VV @VVgV \\ X @> >f > Z
    \end{CD}$$
    Then $$\dL g^* \dR f_{*}\mathcal{E}=\dR \tilde{f}_{*}\dL \tilde{g}^*\mathcal{E}$$
\end{theorem}


The reason this is true is because it works in the usual case for injective sheaves and flat morphisms.

We can apply this to a classical example, the Poincare bundle on the elliptic curve.
\begin{example}{Poincare bundle}{}
When $Z=\mathrm{Spec}\,k$, $W=X\times Y$ then we must have that $$\dR p_{*}q^* \mathcal{E}\simeq g^* \dR f_{*}\mathcal{E}$$where both $f,g$ map to a point. But $\dR f_{*}=\RG$ in this case. The derived category of $\mathrm{Spec}\,k$ is the category of graded vector spaces, where every object can be replaced by its cohomology with zero differential. Hence, the thing on the right is just $$\mathcal{O}_{Y}\otimes_{k} \RG (\mathcal{E})$$where $\RG(\mathcal{E})$ is a graded vector space.

So for example, when $X$ is an elliptic curve, then if $\mathcal{E}=\mathcal{O}_{X}$ concentrated in degree zero, we have $$\RG(\mathcal{O}_{X})=H^\bullet(X,\mathcal{O}_{X})=k\xrightarrow{0}k$$Then $g^* \dR f_*\mathcal{E}= \mathcal{O}_{Y}\xrightarrow{0}\mathcal{O}_{Y}= \mathcal{O}_{Y}\oplus \mathcal{O}_{Y}[1]$. 

Now, let $E$ be an elliptic curve and fix $P_0\in E$. Then every degree zero line bundle is given by $\mathcal{O}_{E}(P-P_{0})$. Hence $$\mathrm{Pic^0(E)}\simeq E$$Can make universal bundle over $\mathcal{L}\xrightarrow{} \mathrm{Pic}^0(E)\times E$ given by $\mathcal{L}:=\mathcal{O}_{E\times E}(\Delta-E\times P_{0})$. We see that $$\mathcal{L}|_{P\times E}\simeq \mathcal{O}_{E}(P-P_{0})$$Now, note that $$H^\bullet (E, \mathcal{O}_{E}(P-P_{0}))=\mathrm{Ext}^\bullet(\mathcal{O}_{P_{0}},\mathcal{O}_{P})=\begin{cases}0, P\neq P_{0}\\ k\oplus k[1], P=P_{0}\end{cases} $$which is the skyscraper sheaf computation we did before.

\end{example}

\begin{example}{Continued}{}

Have the following diagram, to which we want to apply cohomology and base change: $$\begin{CD}
P\times E @> > > E\times E\\ @VVV @VV\pi V \\ P @> > > E
\end{CD}$$
We have just seen, since pushforward to a point is global sections, that$$\dR \pi_{*}\iota^*\mathcal{L}=H^\bullet(E, \mathcal{O}_{E}(P-P_{0}))$$From the cohomology and base change formula, this must be equal to $\dL \iota^*\dR \pi_{*}\mathcal{L}$. We appeal to the fact that $\dR \pi_{*}\mathcal{L}=\mathcal{O}_{P_{0}}[-1]$. Moreover, the ideal sheaf sequence is in particular a Koszul resolution: $$0\rightarrow \mathcal{O}_{E}(-P_{0})\xrightarrow{}\mathcal{O}_{E}\xrightarrow{}\mathcal{O}_{{P_{0}}}\xrightarrow{}0$$This is a resolution of locally free sheaves allowing us to compute the derived restriction pullback of $\mathcal{O}_{{P}_{0}}$ which by inspection is exactly $k\xrightarrow{0}k$ if $P=P_0$ and $0$ if not equal, as expected. 

% Question: why is $\mathrm{R}\pi_{*}\mathcal{L}=\mathcal{O}_{P_{0}}[-1]$? Need to ask Ed.

\end{example}

\begin{remark}{Fourier-Mukai transforms}{}
    What we have just seen is an example of a Fourier-Mukai kernel: the universal line bundle $\mathcal{L}$ on $E\times E$, which defines an endomorphism $\Phi_\mathcal{L}:D^b \mathbf{Coh}(E)\rightarrow D^b \mathbf{Coh}(E), \mathcal{F}\mapsto {\pi_2}_*(\pi_1^* \mathcal{F} \otimes \mathcal{L})$
    
\end{remark}

\subsection{Spectral sequences}
\subsubsection{The spectral sequence associated to a bicomplex}

Given a bicomplex, we can take cohomology in vertical or horizontal direction. Then, get new maps which are like a knight's move in chess. Can iterate and get a sequence of complexes whose cohomology approximates the cohomology of the total complex.

Get pages $$E_{r}^{p,q}\xrightarrow{d_{r}} E_{r}^{p+r,q-r+1}$$
In bounded cases, these eventually become zero. Usually, this happens on the second page. This gives information about the total complex, which has a filtration $$F^{p_{0}} \mathrm{Tot}C^n=\bigoplus_{p\geq p_{0}, p+q=n} C^{p,q}$$Then we claim that $$F^p/F^{p+1} H^n(\mathrm{Tot}\,C)\simeq E_{\infty}^{p,n-p}$$We write this as $$E^{p,q}\implies H^{p+q}(\mathrm{Tot}\,C)$$

Given a commutative ring $R$ and two complexes $A,B$ the tensor product complex is $\bigoplus A^p\otimes B^q$ with Leibniz differential $d(a\otimes b)=da\otimes b + (-1)^p a\otimes db$. 

Assume $A$ is a bounded above complex of flat modules and $B$ is acyclic. Then $A\otimes B$ is acyclic. This is since the first page is just $$E_{1}^{p,q}=H^q(A^p\otimes B)=0$$
This is similar to the statement that if a row or column in a double complex is acyclic, then the vertical and horizontal cohomologies coincide.

Now we move on to the Grothendieck spectral sequence.

\subsubsection{Computing derived functors: the Grothendieck spectral sequence}

Suppose we know $R^iF(A^p)$ or $R^iF(H^pA)$ for a complex $A$. How can we compute $R^iF(A)$ from this information?

Need the Cartan-Eilenberg complex! This is a bicomplex resolution that looks like %![[Cartan-Eilenberg compex|center]]

One can check that $\mathrm{Tot}\,I \rightarrow A$ is a quasi-isomorphism. So $RF(A)=F(\mathrm{Tot}\,I)=\mathrm{Tot}\,FI$. When we take cohomology, we are interested in the $n$-th cohomology of the total complex, for which we have two spectral sequences: one starts with horizontal differential, and the other with the vertical. 

If we start with vertical, then the first page is $$E_{1}^{p,q}=R^qF(A^p)\implies H^nRF(A)$$since we are computing derived functors of $F$. If we start with horizontal, then $$E_{2}^{p,q}=R^qF(H^pA)\implies H^nRF(A)$$

Now we describe two very important instance of the Grothendieck spectral sequence, the Leray spectral sequence and the local to global spectral sequence.

\begin{example}{Leray spectral sequence}{} Consider $X\xrightarrow{g} Y \xrightarrow{f} Z$. The Leray spectral sequence is as follows: $$R^n(f\circ g)_{*}\mathcal{F}=H^nR(f\circ g)_{*}\mathcal{F}=H^n Rf_{*}\circ Rg_{*} \mathcal{F}$$

We are in the situation of trying to compute the n-th derived functor of $F=Rf_*$ of some complex $A=Rg_*\mathcal{F}$. We can apply the second spectral sequence to see that $$E_{2}^{p,q}=R^qf_{*}(R^pg_{*}\mathcal{F})\implies R^n(f\circ g)_{*} \mathcal{F}$$
When we apply this to $Z=\mathrm{Spec}\,\mathbb{Z}$, then $f_*$ is global sections and $Rf_*$ is sheaf cohomology, as is $R(f\circ g)_*$ which gives us the Leray spectral sequence: $$H^q(Y, R^qg_{*}\mathcal{F})\implies H^{p+q}(X,\mathcal{F})$$
\end{example}



\begin{example}{Local to global spectral sequence}{}

We know from before that $$\RG\circ \RlHom=\RHom$$
Upon taking cohomology, on the right hand side we get $\mathrm{Ext}^n(\mathcal{F}, \mathcal{G}).$ On the other hand, taking $F=\RG, A=\RlHom(\mathcal{ F}, \mathcal{G})$ then the spectral sequence gives us $$H^q(X, \lExt^p(\mathcal{F, \mathcal{G))}}\implies \mathrm{Ext}^n(\mathcal{F},\mathcal{G)}$$ \end{example}

As an application, we compute the Ext groups of a point and local Ext of a subvariety. 

More precisely, let $Y\subset X$ be a subvariety given by the zero locus of a section of $\mathcal{E}$, which we can Koszul resolve: $$\xrightarrow{}\mathcal{E}^\lor\xrightarrow{}\mathcal{O}_{X}\xrightarrow{}\mathcal{O}_{Y}\xrightarrow{}0$$i.e. we replace $\mathcal{O}_{Y}={\bigwedge}^\bullet \mathcal{E}^\lor$. Then
$\lExt^\bullet(\mathcal{O}_{Y},\mathcal{O}_{Y})$ is computed by applying $\lHom(-,\mathcal{O}_{Y})$ to the complex and taking cohomology. But once we restrict to $Y$, the maps become zero since they are given by the defining function for $Y$. Hence, the complex is formal and we get $$\lExt^i(\mathcal{O}_{Y},\mathcal{O}_{Y})=\lHom({\bigwedge}^i \mathcal{E}^\lor, \mathcal{O}_{Y})={\bigwedge}^i \mathcal{E} \otimes \mathcal{O}_{Y}={\bigwedge}^i \mathcal{E}|_{Y}={\bigwedge}^i \mathcal{N}_{{Y/X}}$$ This allows us to compute the self Ext groups of a point, by using the local-to-global spectral sequence:$$H^i(X, \lExt^j(\mathcal{O}_{p}, \mathcal{O}_{p}))\implies \mathrm{Ext}^{i+j}(\mathcal{O}_{p}, \mathcal{O}_{p})$$The local homs will be supported at $p$. So it has no higher cohomology i.e. the cases $i>0$ give nothing. But when $i=0$, we have no differential. So in fact $$\mathrm{Ext}^\bullet(\mathcal{O}_{p}, \mathcal{O}_{p})\simeq H^0(X, \lExt^\bullet(\mathcal{O}_{p}, \mathcal{O}_{p}))$$
From the Koszul resolution, we see that the latter is just an exterior algebra!
\begin{remark}{Deformations}{}
    We see that the global sections of the normal bundle of $Y$, which describe its deformations inside $X$, can be described by $\Ext^1(\mathcal{O}_Y,\mathcal{O}_Y)$. 
\end{remark}
\begin{remark}{Mirror symmetry}{}
    In mirror symmetry, varieties come in pairs such that the Floer cohomology groups on one side correspond to Ext groups on the other. If we think of $X$ as the moduli space of its skyscraper sheaves, then since Ext groups should match up with self Floer groups, the mirrors to points should be Lagrangians with self Floer cohomology equal to an exterior algebra. But self Floer cohomology is equal to usual cohomology for unobstructed Lagrangians, which motivates the fact that mirror to points we should have (special) Lagrangian tori. This is the basis of the SYZ philosophy.
    
\end{remark}

\subsection{Serre duality}

The classical statement is as follows:

\begin{proposition}{Classical Serre duality}{Classical Serre duality}
    If $X$ is smooth projective over alg. closed $k$, and $\mathcal{E}$ is a vector bundle on $X$, then $$H^i(X,\mathcal{E})^*\simeq H^{n-i}(X, \mathcal{E}^\lor\otimes \omega_{X})$$
\end{proposition}

The duality is given by a pairing. Namely, we have a perfect pairing$$H^i(X,\mathcal{E})\otimes H^{n-i}(X,\mathcal{E}^\lor\otimes \omega_{X})\xrightarrow{}H^n(X, \mathcal{E}\otimes \mathcal{E}^\lor\otimes \omega_{X})\xrightarrow{}H^n(X, \omega_{X})\xrightarrow{}k$$
Also can prove this using Hodge star on vector bundles.

There is a hypercohomology version. If we replace $\mathcal{E}$ by a complex of vector bundles, we define the dual complex as $$\lHom(\mathcal{E},\mathcal{O})^n=\lHom(\mathcal{E}^{-n}, \mathcal{O})$$Have a map $$\mathcal{E}^\lor \otimes \mathcal{E}\xrightarrow{}\mathcal{O}$$

%*Example:* $\mathcal{E}=V^0\xrightarrow{}W^1$. The dual complex is $W^\lor\xrightarrow{}V^\lor$, where now $W^\lor$ lives in degree $-1$. The tensor complex is $$W^\lor \otimes V \xrightarrow{} V^\lor \otimes V \oplus W^\lor \otimes W \xrightarrow{} V^\lor \otimes W$$The map is the natural one in degree zero. 

So in the same way can construct a pairing: if we define $$\mathbb{H}^i(X,\mathcal{E})=H^i\RG(\mathcal{E)}$$ then get 

\begin{proposition}{Serre duality for complexes}{Serre duality for complexes}
        $$\mathbb{H}^i(X,\mathcal{E})\otimes \mathbb{H}^{n-i}(X, \mathcal{E}^\lor \otimes \omega_{X})\xrightarrow{}k$$
The claim is that this pairing is still perfect.
\end{proposition}

There is a stupid truncation where we just kill off any terms after a certain point. Have short exact sequence like %![[Stupid truncation|center|300]]
Then get LES on hypercohomology and reduce to the case of vector bundles (this method of proof is called devissage).

Recall that in $\mathcal{D}^b\mathbf{Coh}(X)$, any object is represented by a complex of vector bundles. 

There is another form of Serre duality:

\begin{proposition}{Categorical form of Serre duality}{Categorical form of Serre duality}
    If $A,B\in \mathcal{D}^b\mathbf{Coh}(X)$, then $$\mathrm{Hom}(A,B)^*\simeq \mathrm{Hom}(B,A\otimes \omega_{X}[n])$$
\end{proposition}

The idea is as follows: we can compute the Homs of the derived category as 
$$\begin{gathered}
    \mathrm{Hom}_{\mathcal{D}}(B,A\otimes \omega_{X}[n])\simeq H^n\RHom(B,A\otimes \omega_{X})\\=H^n \RG ( \RlHom(B,A\otimes \omega_{X}))=\\=\mathbb{H}^n(X,B^\lor \otimes A \otimes \omega_{X})
\end{gathered}$$

Similarly, $$\begin{gathered}
\mathrm{Hom}_{\mathcal{D}}(A,B)=H^0\RHom(A,B)=H^0 \RG(X,\RlHom(A,B))=\\=\mathbb{H}^0(X,\RlHom(A,B))=\mathbb{H}^0(X, A^\lor\otimes B)
\end{gathered}$$
These are dual by the previous version of Serre duality, applying it to $\mathcal{E}=A^\lor \otimes B$. 

\begin{definition}{Serre functor}{Serre functor}
    Define $S:\mathcal{D}(X)\rightarrow \mathcal{D}(X), F\mapsto F\otimes \omega_{X}[n]$. Then have $$\mathrm{Hom}(A,B)^*\simeq \mathrm{Hom}(B,S(A))$$
     A Serre functor is an additive, k-linear autoequivalence obeying the above property
\end{definition}

Two such functors are canonically equivalent, since $S(A)$ represents the functor $B\mapsto \mathrm{Hom}(A,B)^*$. 

% Check that $S$ commutes with any autoequivalence: $$\begin{gathered}
% \mathrm{Hom}(B,SFA)\simeq \mathrm{Hom}(FA,B)^*\\
% \mathrm{Hom}(B,FSA)\simeq \mathrm{Hom}(F^{-1}B,SA)\simeq \mathrm{Hom}(A, F^{-1}B)^*\simeq \mathrm{Hom}(FA,B)^*
% \end{gathered}$$So the two represent the same functor.

% The element $1_A$ corresponds via the isomorphism to some $\tau_A: \mathrm{Hom}(A, S(A))\xrightarrow{}k$, which we call a trace. 

% *Exercise:* given sequence $$A\xrightarrow{x}B\xrightarrow{y}S(A)\xrightarrow{S(x)}S(B)$$then $\mathrm{Tr}(yx)=\mathrm{Tr}(S(x)y)$. 

The Serre functor allows us to switch between left and right adjoints. Suppose $F$ left adjoint to $G$. Then $SFS^{-1}$ is right adjoint to $G$. 

% The point is that the duality pairing is the same as the composition and then the trace: $\mathrm{Tr}(y\circ x)=\mu(x,y)$, where $\mu$ is the duality pairing. Claim we have a commutative diagram, where on the left we send $(x,y)\mapsto(y, Sx)$. 
% $$\begin{CD}
% \mathrm{Hom}(A,B)\otimes \mathrm{Hom}(B,SA)@> > > k\\ @VVV @VVV \\ \mathrm{Hom}(B,SA)\otimes \mathrm{Hom}(SA,SB)@> > > k
% \end{CD}$$
% Equivalently, can think about composite isomorphisms $$\mathrm{Hom}(B,SA)\simeq \mathrm{Hom}(A,B)^*\simeq \mathrm{Hom}(SA,SB)^*\simeq \mathrm{Hom}(B,SA)$$
% The first arrow sends $x\mapsto \mu(x,-)$. However, the leftmost arrow is given by $x\mapsto \mu(-,x)$. Hence, the two are related via $S$ and so $\mathrm{Tr}(yx)=\mu(x,y)=\mu(y,Sx)=\mathrm{Tr}(S(x)y)$. 

\begin{example}{Shriek functor}{Shriek functor} Given $f:X\rightarrow Y$, have that $\dL f^*$ is left adjoint to $\dR f_{*}$. In both categories have Serre functors, so can obtain the right adjoint to the pushforward as $$\begin{gathered}
f^!(A):=(\dL f^*A\otimes f^*\omega_{Y}^{-1}[-\dim Y])\otimes \omega_{X}[\dim X]=\\=\dL f^*A\otimes (f^*\omega_{Y}^{-1}\otimes \omega_{X})[\dim X -\dim Y]\end{gathered}$$
We call $\omega_{f}=f^*\omega_{Y}^{-1}\otimes \omega_{X}=f^!\mathcal{O}_{Y}$, the relative dualizing sheaf. Hence get $$\mathrm{Hom}(\dR f_{*}A, B)\simeq \mathrm{Hom}(A, f^!B)$$
In fact, there is a sheafified version: $$\RlHom(\dR f_{*}A,B)=\dR f_{*}\RlHom(A,f^!B)$$
In particular, with $B=\mathcal{O}_{Y},$ get $$(\dR f_{*}\mathcal{F})^\lor\simeq \dR f_{*}(\mathcal{F}, \omega_{f}[\dim X-\dim Y])$$
Putting $Y=pt$, get usual Serre duality! So this can be seen as a relative version of Serre duality. But in general, cannot take the pieces $R^i$ as dual! Have to keep the whole chain complex.
\end{example}

\begin{example}{Poincare bundle again}{} Take the universal line bundle on an elliptic curve. The canonical bundle is trivial, so by relative Serre duality we have $$(\dR \pi_{*}\mathcal{L})^\lor\simeq \dR \pi_{*}\mathcal{L}^{-1}[1]$$Can use Cech resolutions to see that $f_*\mathcal{L}$ is a torsion free sheaf supported at a point, so has to be zero. So $R^0=0$ on both sides. But $R^1\pi_{*}\mathcal{L}=\mathcal{O}_{P_{0}}[1]$ as we saw before, so the duality does not hold termwise, but over the whole complex! This means that there is a group $$\lExt^1(\mathcal{O}_{P_{0}}, \mathcal{O})=\mathcal{O}_{P_{0}}$$There is a generalization of $f^!$ to general nice schemes, if we work with quasicoherent sheaves. Still have duality isomorphisms and the isomorphism $f^!\mathcal{F}\simeq \dL f^*\mathcal{F}\otimes f^!\mathcal{O}$. \end{example}

%In general, if $p:X\rightarrow pt$, we are interested in $p^!(\mathcal{O}_{pt})=\mathcal{D}_{X}$. But we can compose with an embedding into projective space $i:X\rightarrow \mathbb{P}^n$ and since adjoints are functorial, see that $\mathcal{D}_{X}=i^!\mathcal{D}_{\mathbb{P}^n}=i^!\omega_{\mathbb{P}^n}[n]$. So need to understand $i^!$ for an embedding. But it can actually be defined as a derived functor!

%If we have a closed embedding $i:X\rightarrow Y$, there is an abelian version of $i^!$, namely a derived functor of $$\mathcal{F}\mapsto \lHom(i_{*}\mathcal{O}_{X},\mathcal{F})=i_{*}(\mathcal{H}^0i^!\mathcal{F})$$More generally, $$\RlHom(i_{*}\mathcal{O}_{X},\mathcal{F})\simeq i_{*} i^!\mathcal{F}$$If $X$ is Cohen-Macaulay, then we have a formula for the dualizing sheaf: $$i_{*}\omega_{X}\simeq \lExt^{codim X}(i_{*}\mathcal{O}_{X}, \omega_{\mathbb{P}^n})$$
%So we have that $\mathcal{D}_{X}\simeq \omega_{X}[n]$ and Serre duality becomes $H^i(X,\mathcal{F})^*\simeq H^{n-i}(\mathcal{F}, \omega_{X})$. 

% example of a (2,3) K3 surface in P4?

\subsection{Fourier-Mukai transforms}

\begin{definition}{Fourier-Mukai functor}{Fourier-Mukai functor}
    Given $\mathcal{E}\in \mathcal{D}^b\mathrm{Coh}(X\times Y)$, we get a Fourier Mukai functor $$\begin{gathered}
    FM_{\mathcal{E}}:\mathcal{D}(X)\xrightarrow{}\mathcal{D}(Y)\\
    \mathcal{F}\mapsto \dR q_{*}(\mathcal{E}\otimes \dL p^*\mathcal{F})
    \end{gathered}$$  
\end{definition}

All of the functors we have so far encountered are FM transforms:
\begin{itemize}
    \item  given $f:X\rightarrow Y$ with $\Gamma_f\subset X\times Y$, the structure sheaf of the graph is the kernel of the pushforward functor and the pullback functor, depending on the way we go.

    Have $\mathcal{O}_{\Gamma}=(1\times f)_{*}\mathcal{O}_{X}$ and we use the projection formula: $$\begin{gathered}
q_{*}(\mathcal{O}_{\Gamma}\otimes p^*\mathcal{F})=q_{*}((1\times f)_{*}(\mathcal{O}_{X}\otimes (1\times f)^*p^*\mathcal{F}))=f_{*}\mathcal{F}\end{gathered}$$

    \item Tensoring with $\mathcal{G}$ is the Fourier-Mukai transform with respect to $\Delta_{*}\mathcal{G}$.
    \item Shift functor is induced by $\mathcal{O}_{\Delta}[n]$.
    \item If $Y$ is a fine moduli space of sheaves on $X$ equipped with a universal sheaf $\mathcal{E}\rightarrow X\times Y$ parametrizing sheaves by restricting to $X\times \{y\}$. We see that the Fourier-Mukai transform w.r.t. the universal sheaf of a skyscraper sheaf $\mathcal{O}_{y}$is $\mathcal{E}|_{X\times \{y\}}$, the sheaf that the point $y\in Y$ parametrizes. Have induced map $$T_{y}Y=\mathrm{Ext}^1(\mathcal{O}_{y},\mathcal{O}_{y})\rightarrow \mathrm{Ext}^1(\mathcal{E}|_{X\times \{y\}},\mathcal{E}|_{X\times \{y\}})$$This is the so-called Kodaira-Spencer map! Deformations of the point gives first-order deformations of the sheaf.
\end{itemize}

Given kernels $\mathcal{E}, \mathcal{E}'$ on $X\times Y$ and $Y\times Z$ respectively, we consider the kernel $\mathcal{E}''=\pi_{*}(\pi^*\mathcal{E}\otimes \pi^*\mathcal{E}')$ on $X\times Z$ by pulling to the triple product and then pushing down. We claim that $$FM(\mathcal{E'})\circ FM(\mathcal{E)}=FM(\mathcal{E}'')$$This is done by using the projection formula a bunch of times and finally an instance of flat base change. Basically, first transform everything to a tensor product on the triple product $X\times Y \times Z$ by using the projection formula. Then use commutativity of diagram using different ways to factorize the projection to $Z$. Finally, use projection formula again and base change for the diamond involving $X\times Y \times Z, X\times Y, Y\times Z, Y$. 

The adjoints of a Fourier-Mukai funcotr are given by the dual kernel together with a Serre functor: given $FM_\mathcal{E}$ going from $X$ to $Y$, have two adjoints given by $FM_{\mathcal{E}^\lor \otimes \pi^* \omega_{X}[\dim X]}$ and $FM_{\mathcal{E}^\lor \otimes \pi^* \omega_{Y}[\dim Y]}$. Need Grothendieck-Verdier duality! We omit the derived notation:

$$\begin{gathered}
\mathrm{Hom}_{Y}(FM(\mathcal{F}), \mathcal{G})=\mathrm{Hom}_{Y} (\pi_{*} (\mathcal{E} \otimes \pi^* \mathcal{F}), \mathcal{G})\simeq \mathrm{Hom}_{X\times Y}(\mathcal{E\otimes \pi^*\mathcal{F}}, \pi^! \mathcal{G})\simeq \\ \simeq \mathrm{Hom}_{X\times Y}(\mathcal{E\otimes \pi^*\mathcal{F}}, \pi^*\mathcal{G}\otimes \omega_{\pi})\simeq \simeq \mathrm{Hom}_{X\times Y}(\mathcal{E\otimes \pi^*}\mathcal{F}, \pi^*\mathcal{G} \otimes \pi^* \omega_{X}[\dim X])\simeq \\ \simeq \mathrm{Hom}_{X\times Y}(\pi^*\mathcal{F, \mathcal{E}^\lor}\otimes \pi^*\mathcal{G} \otimes \pi^* \omega_{X}[\dim X])\simeq \\ \simeq \mathrm{Hom}_{X}(\mathcal{F}, FM(\mathcal{G}))
\end{gathered}$$

From this, we can conclude that if a kernel induces an equivalence, then the dimensions of the two varieties should be the same.

\begin{theorem}{Orlov}{Orlov's theorem on Fourier-Mukai transforms}
Every fully faithful exact functor between is induced by a Fourier-Mukai transform. In particularm every equivalence as well.
\end{theorem}
There is a generalization by Canonaco and Stellari which requires only that $\mathrm{Ext}^i(F,F)=0, i < 0 \implies \mathrm{Ext}^i(\Phi F,\Phi F)=0$. 

% We can consider a 2-category with objects smooth projective varieties, morphisms given by Fourier-Mukai transforms via kernels and 2-morphisms are maps of kernels. Orlov's theorem says the functor into the 2-category of triangulated categories is essentially injective.

\subsection{Exceptional collections and semiorthogonal decompositions}

\begin{definition}{Exceptional object}{Exceptional object}
    An exceptional object is one with the cohomology of a point: $$\mathrm{Hom}_{\mathcal{D}}(E,E)=k, \mathrm{Hom}_{\mathcal{D}}(E,E[i])=0, i\neq 0$$
\end{definition}


For example, line bundles on $\mathbb{P}^n$ and more generally on Fanos by Kodaira vanishing. Also, $\mathcal{O}_{E}(t)$ on a blowup at a point with exceptional divisor $E$. This is done by applying LES to the ideal sheaf sequence $$0\xrightarrow{}\mathcal{O}_{\tilde{X}} (-E)\xrightarrow{}\mathcal{O}_{\tilde{X}}\xrightarrow{}\mathcal{O}_{E}\xrightarrow{}0$$Then hom into $\mathcal{O}_{E}$. Have $$\mathrm{Ext}(\mathcal{O}(-E), \mathcal{O}_{E})=H^\bullet_{\tilde{ X}} (\mathcal{O}_{E}(E))\simeq H^\bullet_{E} (\mathcal{O}_{E}(-1))=0$$since $E=\mathbb{P}^{n-1}$. Moreover, since $p^*\mathcal{O}_{X}=\mathcal{O}_{\tilde{X}}$, by adjunction we get $$\Ext(\mathcal{O}_{\tilde{X}}, \mathcal{O}_E)=\Ext(\mathcal{O}_X, p_*\mathcal{O}_E)=\Ext(\mathcal{O}_X, \mathcal{O}_p)=\mathbb{C} \text{ in degree }0$$

Many homogenous vector bundles are exceptional.

\begin{example}{Tangent bundle of projective space}{} 
    $\mathcal{T}_{\mathbb{P}^n}$ is exceptional. One can probably chase around the LES's associated to the Euler sequence $$0\rightarrow \mathcal{O}\rightarrow \mathcal{O}(1)^{\oplus n+1}\rightarrow \mathcal{T}\rightarrow 0$$
    We prefer a different approach, using the notion of a (dual) spherical twist (more on this later). Given a spherical object $\mathcal{E}$, we can construct two twists, along the evaluation and coevaluation maps respectively: $$T_\mathcal{E}\mathcal{F}:=\mathrm{cone}(\bigoplus_i \Hom(\mathcal{E},\mathcal{F}[i])\otimes \mathcal{E}[-i]\rightarrow \mathcal{F}), T^\lor_\mathcal{E}\mathcal{F}:=\mathrm{cone}(\mathcal{E}\rightarrow \bigoplus_i \Hom(\mathcal{E},\mathcal{F}[i])\otimes \mathcal{E}[-i] )$$
    We can see that our version of the Euler sequence implies that $\mathcal{T}=T^\lor_\mathcal{O}(\mathcal{O}(1))$. Similarly, the dual version of the Euler sequence implies that $\Omega=T_{\mathcal{O}(-1)}\mathcal{O}$. Since spherical twists are autoequivalences and preserve endomorphisms, this means that the tangent and cotangent bundles are exceptional, just as the line bundles on projective space.
\end{example}

Nonexamples: deformable objects, e.g. skyscraper sheaves, line bundles on curves.

\begin{remark}{}{}
    Calabi-Yau's don't admit exceptional objects by Serre duality. However, they do admit spherical objects, e.g. $\mathcal{O}_C$ for a rational curve $C$ in a K3 surface.
\end{remark}

\begin{definition}{Exceptional collections}{Exceptional collections}
    A collection $E_i$ is exceptional if each $E_i$ is exceptional and there are no homs from right to left: $\mathrm{RHom}(E_{i}, E_{j})=0, i>j$.
\end{definition}


For example, $\mathcal{O},\dots,\mathcal{O}(n)$ on projective space. Cannot have more, since then will have the cohomology of the canonical bundle $\omega=\mathcal{O}(-n-1)$ which is nonzero. In fact, Beilinson's theorem shows that these form a full exceptional collection. 

More generally, for a Fano, $\omega_{X}=\mathcal{O}_{X}(-k)$ is antiample. Then $\mathcal{O}, \dots, \mathcal{O}(k-1)$ is exceptional. We will come back to this when we discuss the cubic fourfold.

% For a blowup $\tilde{X}\xrightarrow{}\mathbb{P}^2$ we have line bundles $\mathcal{O}_{E}(-1), \mathcal{O}, \mathcal{O}(H), \mathcal{O}(2H)$ and moreover $$\mathrm{R}\Gamma(\mathcal{O}_{\tilde{X}})=\mathrm{R}\Gamma \,\mathrm{R}f_{*}\mathcal{O}_{\tilde{ X}}=\mathrm{R}\Gamma \mathcal{O}_{\mathbb{P}^2}=k[0]$$since the higher pushforwards of a blowup vanish. So the objects are exceptional. They form an exceptional collection since $\mathcal{O}_{\tilde{X}}(H)=f^*\mathcal{O}(1)$ and then we can use adjunction. The exceptional collection downstairs gives us an exceptional collection upstairs. We also need to check $$\mathrm{Ext}_{\tilde{ X}}(\mathcal{O}(tH), \mathcal{O}_{E}(-1))=\mathrm{Ext}_{\mathbb{P}^2}(\mathcal{O}(t), \mathrm{R}f_{*}\mathcal{O}_{E}(-1))=0$$For this, we can use the base change formula to see that $\mathrm{R}f_{*}\mathcal{O}_{E}(-1)=0$ since by base change this is the line bundle on the exceptional divisor pushed down to a point, i.e. the cohomology of the tautological line bundle.

Notation: we put $E \perp F$ whenever $\mathrm{RHom}(E,F)=0$. This is not a symmetric relation! It is on Calabi-Yau's. 

\begin{definition}{Full exceptional collection}{Full exceptional collection}
    An exceptional collection is full if you can generate every object by sums, shifts and cones.

\end{definition}

\begin{theorem}{Beilinson}{Beilinson's theorem}
    On $\mathbb{P}^n,$ the exceptional collection $\mathcal{O},\dots,\mathcal{O}(n)$ is full.
\end{theorem} 

% one method of proof: use Koszul resolution of skyscrapers to see they are contained in this subcategory. Then, find the orthogonal complement is empty, for which we need the collection to be exceptional. Suppose that $\mathrm{RHom}(\mathcal{O}_{p}, \mathcal{F})=0,\forall p \in X$. Use the Grothendieck spectral sequence $$\mathrm{R}^p\mathrm{Hom}(\mathcal{O}_{p}, \mathcal{H}^q \mathcal{F})\implies \mathrm{R}^{p+q}\mathrm{Hom}(\mathcal{O}_{p},\mathcal{F})=0 $$If we choose $q$ maximal with $\mathcal{H}^q\mathcal{F}\neq 0$ and $p\in \mathrm{supp}\,\mathcal{F}$, then we will have a nonzero term in the top right corner of the second page, which survives to infinity. This is a contradiction, and hence either $\mathcal{F}=0$ or all the cohomologies are zero. 

% Junk on blowup of P2
% Want to show that for a blowup $\mathrm{R}f_{*}\mathcal{O}_{\tilde{X}}=\mathcal{O}_{X}$. By Zariski's main theorem, have that it's true for $R^0$. Have projective bundle $\mathbb{P}^n\xrightarrow{}E\xrightarrow{}Z$ and a SES $$0\xrightarrow{}\mathcal{O}_{\tilde{X}}(-E)\xrightarrow{}\mathcal{O}_{\tilde{ X}}\xrightarrow{}\mathcal{O}_{E}\xrightarrow{ }0$$Hence, $\mathrm{R}f_{*}\mathcal{O}_{E}=\mathcal{O}_{Z}$. When we push down to $X$ under the LES, the first level is the ideal sheaf sequence for $Z$. Can twist by $-E$, hence $\mathcal{O}_{E}(E)=\mathcal{O}_{E}(1)$. Want to show these have no higher pushforwards. In particular, $R^{>0}f_{*}(\mathcal{O}(-nE))=0, n\gg 0$. But $\mathcal{O}_{X}(-E)=\mathcal{O}_{f}(1)$ is relatively ample, so can use Serre vanishing? Not sure.

% > [!theoremred] Theorem (Kapranov)  Let $\mathcal{U}\xrightarrow{}\mathrm{Gr}_{k}(n)$ be the tautological bundle over the Grassmanian. Then the Schur functors $\mathrm{Schur}^\lambda \mathcal{U}^\lor$ for $\lambda$ a Young diagram form a full exceptional collection.

%Blowup exceptional collection
%Let's go back to the example of the blowup of $\mathbb{P}^2$ at a point. For any $p\notin E$, we have that $\mathcal{O}_{p}=\mathrm{L}f^*\mathcal{O}_{f(p)}$ which we can Koszul resolve on the base then pull back to get $$\mathcal{O}_{\tilde{X}}(-2H)\xrightarrow{}\mathcal{O}_{\tilde{ X}}(-H)^2\xrightarrow{}\mathcal{O}_{\tilde{X}}\xrightarrow{}\mathcal{O}_{p}$$So these skyscraper sheaves are in the span of $\mathcal{O},\mathcal{O}(H),\mathcal{O}(2H)$, after twisting by $2H$. When $p\in E$, then $f(p)$ is in the center. By exercise, have $$\mathrm{L}_{i}f^*\mathcal{O}_{f(p)}=\begin{cases}
%\mathcal{O}_{E},i=0 \\
%\mathcal{O}_{E}(-1), i=1
%\end{cases}$$
%Hence, have a map $\mathcal{O}_{E}(-1)[1]\xrightarrow{}\mathrm{L}f^*\mathcal{O}_{f(p)}$ since all complexes admit a map from their last cohomology and a map to their first cohomology. The cone of this map has to be $\mathcal{O}_{E}$ by looking at the LES in cohomology. 

%Finally, have a SES $$0\rightarrow \mathcal{O}_{E}(-1)\xrightarrow{}\mathcal{O}_{E}\xrightarrow{}\mathcal{O}_{p}\xrightarrow{}0$$This shows that the exceptional collection is full. 

%Quadric in P5 Have that $\omega_{Q}=\mathcal{O}(-4)$ so have exceptional collection of line bundles up to degree 4. We will show this is not full. This contains a plane $P\subset Q$. Consider $\mathcal{O}_{P}(1)$. Then $$\mathrm{RHom}(\mathcal{O}_{Q}(3), \mathcal{O}_{P}(1))=\mathrm{R\Gamma}(\mathcal{O}_{P}(-2))=0$$Similarly with $\mathcal{O}_{Q}(2)$. However, with $\mathcal{O}_{Q}(1)$ get $\mathrm{R}\Gamma (\mathcal{O}_{P})=k$. So it is not orthogonal! Consider the kernel of the restriction morphism $$0\xrightarrow{}\mathcal{I}_{P/Q}(1)\xrightarrow{}\mathcal{O}_{Q}(1)\xrightarrow{}\mathcal{O}_{P}(1)\xrightarrow{}0$$We claim that the ideal sheaf is orthogonal to the line bundles. Up to a shift, this is a cone of two things which were already orthogonal to $\mathcal{O}(2), \mathcal{O}(3)$ but orthogonality is closed under taking cones. So we need only worry about $\mathcal{O}(1)$. Then use LES to conclude that $\mathrm{Ext}^\bullet(\mathcal{O}_{Q}(1), \mathcal{I}(1))=0$. What about $\mathcal{O}_{Q}$?

%Via the LES again, we can conclude that $\mathrm{Ext}^\bullet(\mathcal{O}_{Q}, \mathcal{I})=k^3$ concentrated in degree 3, given by the three linear forms cutting out $P$. So not orthogonal and play the same game again: $$0\xrightarrow{}\mathcal{S}\xrightarrow{}\mathcal{O}_{Q}^3\xrightarrow{}\mathcal{I}\xrightarrow{}0$$Then $\mathcal{S}$ is orthogonal to $\mathcal{O}, \mathcal{O}(1),\dots,\mathcal{O}(3)$. It is of rank $2$ so is nonzero. It is a spinor bundle? Moreover, it is exceptional - see exercises.

%In Kapranov's paper, if we take planes $P_+, P_-$ from two families on $Q,$ then $S_+, S_-$ are exceptional and $$\mathcal{D}^b(Q)=\langle S_{+},S_{-}, \mathcal{O}_{Q}, \mathcal{O}_{Q}(1), \mathcal{O}_{Q}(2), \mathcal{O}_{Q}(3)\rangle$$
%See: Bondal-Orlov on two quadric intersecting, Kuznetsov on cubic fourfold.

\begin{definition}{Admissible subcategory}{Admissible subcategory}
    A full subcategory $\mathcal{A}$ closed under shifts and cones is admissible if the inclusion admits both a left and a right adjoint.
\end{definition}

For example, the image of a fully faithful functor $\mathcal{D}(Y)\xrightarrow{}\mathcal{D}(X)$ which is induced by a FM kernel, so has adjoints given by Serre functors.

Nonexample: the subcategory generated by skyscrapers. This has empty orthogonal complement, but everything in it has finite support. But if one has an admissible subcategory with empty orthogonal, it actually generates the whole category.

\begin{proposition}{}{}
    If $\mathcal{A}$ is admissible and $\mathcal{A}^\perp=0$, then $\mathcal{A}=\mathcal{D}(X)$.
\end{proposition}
\begin{proof}[Proof]
    We first notice the general fact that for any admissible category, by having adjoints, if $B\in\mathcal{A}^\perp$ then for all $A$ we have $$\mathrm{RHom}(IA, B)=\mathrm{RHom}(A,RB)=0$$By Yoneda, this implies $RB=0$, so $\mathcal{A}^\perp = \ker R$. Similarly, $^\perp \mathcal{A}=\ker L.$ 
    
    We can use the counit of adjunction to get a map $IRB\xrightarrow{}B$. The cone is in $\mathcal{A}^\perp=0$, so $B\in \mathcal{A}$.  The reason is that for any $A\in \mathcal{A}$, we have an LES $$\dots\xrightarrow{}\mathrm{Hom}(IA, IRB)\xrightarrow{}\mathrm{Hom}(IA, B)\xrightarrow{}\mathrm{Hom}(IA,cone)\xrightarrow{}\dots$$But $\mathrm{Hom}(IA,IRB)=\mathrm{Hom}(A,RIRB), \mathrm{Hom}(IA,B)=\mathrm{Hom}(A,RB)$ and these two are isomorphic by adjoint triangle. The map is actually given by $R\epsilon, \epsilon: IR\xrightarrow{ }1$.  But $I$ is fully faithful, so $\eta$ is an isomorphism and hence $R\epsilon$ is an isomorphism. 
\end{proof}

\begin{remark}{}{}
     Given an exceptional $E$, can think of it as an object on $\mathcal{D}(pt\times X)$ and its induced map $FM_{E}:\mathcal{D}(pt)\xrightarrow{}\mathcal{D}(X)$ is fully faithful, sending a vector space $V\mapsto V\otimes E$. The endomorphisms on both sides agree: $\mathrm{Ext}^\bullet(k,k)=k=\mathrm{Ext}^\bullet(E,E)$. The right adjoint is given by the kernel $E^\lor$ so it sends $F\mapsto \pi_* (E^\lor \otimes F)=\Ext^\bullet(E,F)$, since derived projection is taking cohomology. The counit provides us with an evaluation map $$E\otimes \Ext^\bullet(E,F)\xrightarrow{ev}F$$In general, objects of $\mathcal{D}(X)$ correspond to functors from $\mathcal{D}(pt)$ and exceptionals correspond to fully faithful functors. We will see that spherical twists come from taking cones on the (co)evaluation maps.
\end{remark}


\begin{definition}{Semi-orthogonal decomposition}{Semi-orthogonal decomposition}
    A semiorthogonal decomposition is a sequence of admissible subcategories $\mathcal{A}_{i}$ such that $\mathcal{A}_{j}\perp \mathcal{A}_{i}, i<j$ and they generate $\mathcal{D}(X)$.
\end{definition}


\begin{proposition}{Projective bundle formula for derived categories}{Projective bundle formula for derived categories}
    Given vector bundle $E\rightarrow X$ of rank $n+1$ we have a semiorthogonal decomposition $$\mathcal{D}(\mathbb{P}(E))=\langle f^*\mathcal{D}(X), f^*\mathcal{D}(X)\otimes \mathcal{O}(1),\dots, f^*\mathcal{D}(X)\otimes \mathcal{O}(n)\rangle$$
\end{proposition}

\begin{proof}
    We see that $f^*$ is fully faithful: $$\RHom(f^*a,f^*b)=\RHom(a, f_{*} (f^*b\otimes \mathcal{O}_{\mathbb{P}(E)}))=\RHom(a, b)$$since $f_*\mathcal{O}_{\mathbb{P}(E)}=\mathcal{O}_{X}$. So each of the bits is admissible. Now need to show there are no Rhoms: $$\begin{gathered}
\RHom(f^*a\otimes \mathcal{O}(i), f^*b\otimes \mathcal{O}(j))=\RHom(a, f_{*}(f^*b\otimes \mathcal{O}(j-i)))=\\
=\RHom(a, b\otimes f_{*}\mathcal{O}(j-i))=0
\end{gathered}$$for $i<j$. Finally, need to show generation. For a point $p\in \mathbb{P}(E)$, have Koszul resolution on the fibers. But a fiber has $\mathcal{O}_{F}=f^*\mathcal{O}_{q}$ where $f(F)=q$. So can generate everything fiberwise via Beilinson.  
\end{proof}

This allows us to talk about blowups in general! Since over the exceptional locus we have a projective bundle. 

Given a blowup $f:\tilde{X}\xrightarrow{}X$, we still have that $f^*$ is fully faithful, so we have an admissible subcategory $f^*\mathcal{D}(X)$. Moreover, have a fully faithful functor $\varphi_{t}:\mathcal{D}(Z)\xrightarrow{}\mathcal{D}(\tilde{X})$ given by sending $F$ to $j_{*}(f^*F\otimes \mathcal{O}_{E}(tE)), t\in \mathbb{Z}$. This is a Fourier-Mukai transform with kernel $\mathcal{O}_{E}(tE)$.

%*Exercise:* find the right adjoint of this and show it composes to identity.

\begin{theorem}{Bondal-Orlov blowup formula}{Bondal-Orlov blowup formula}
    $$\mathcal{D}(\tilde{X})=\langle \varphi_{{k-1}}\mathcal{D}(Z),\dots,\varphi_{1}\mathcal{D}(Z), f^*\mathcal{D}(X)\rangle$$
\end{theorem}

Compare with the formula for cohomology!


\section{Flips and flops}
\input{flops.tex}

\section{K3 surfaces and the cubic fourfold}

